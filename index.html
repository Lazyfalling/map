<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地图图形面积教学工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f0f8ff;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 300px;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            overflow-y: auto;
        }

        .main-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #mapCanvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            border: 2px solid #34495e;
        }

        .controls {
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        button:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
        }

        .info-panel {
            background-color: #34495e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .info-item {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .scale-info {
            background-color: #e74c3c;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .area-display {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            border: 2px solid #2c3e50;
        }

        .instructions {
            background-color: #27ae60;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 12px;
            line-height: 1.4;
        }

        .status {
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }

        .status.drawing {
            background-color: #f39c12;
            color: white;
        }

        .status.ready {
            background-color: #27ae60;
            color: white;
        }

        .mode-btn {
            background-color: #95a5a6;
            margin: 5px 2px;
            padding: 8px 12px;
            font-size: 12px;
        }

        .mode-btn.active {
            background-color: #e74c3c;
        }

        .mode-btn:hover {
            background-color: #7f8c8d;
        }

        .mode-btn.active:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2 style="margin-bottom: 20px; text-align: center;">地图面积测量工具</h2>
            
            <div class="scale-info">
                比例尺: 1:12m<br>
                1厘米 = 12米
            </div>



            <div id="status" class="status ready">准备就绪</div>

            <div class="controls">
                <div class="control-group">
                    <label style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="showAreaToggle" checked style="margin-right: 8px;">
                        计算面积
                    </label>
                </div>
                
                <div class="control-group">
                    <button id="dragModeBtn" class="mode-btn active">拖拉模式</button>
                    <button id="drawModeBtn" class="mode-btn">绘制模式</button>
                </div>
                
                <div class="control-group">
                    <button id="newAreaBtn">新建区域</button>
                    <button id="undoBtn" disabled>撤销</button>
                    <button id="clearAllBtn">清空全部</button>
                </div>
                

            </div>

            <div class="info-panel">
                <h3 style="margin-bottom: 10px;">测量信息</h3>
                <div id="currentArea" class="info-item">当前区域面积: 0 平方米</div>
                <div id="totalArea" class="info-item">总面积: 0 平方米</div>
                <div id="areaCount" class="info-item">区域数量: 0 个</div>
            </div>

            <div class="info-panel">
                <h3 style="margin-bottom: 10px;">操作历史</h3>
                <div id="history" style="max-height: 150px; overflow-y: auto; font-size: 12px;">
                    等待开始测量...
                </div>
            </div>
        </div>

        <div class="main-area">
            <div class="canvas-container">
                <canvas id="mapCanvas"></canvas>
            </div>
        </div>
    </div>

    <script>
        class MapAreaCalculator {
            constructor() {
                this.canvas = document.getElementById('mapCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.mapImage = new Image();
                
                this.areas = []; // 存储所有绘制的区域
                this.currentArea = []; // 当前正在绘制的区域
                this.isDrawing = false;
                this.scale = 12; // 比例尺: 1厘米 = 12米
                
                // 地图拖动相关
                this.isDragging = false;
                this.dragStart = { x: 0, y: 0 };
                this.mapOffset = { x: 0, y: 0 };
                this.mapScale = 1; // 地图缩放比例
                
                // 面积显示控制
                this.showAreaLabels = true;
                
                // 模式状态: 'drag' 或 'draw'
                this.currentMode = 'drag';
                
                this.colors = [
                    'rgba(255, 99, 132, 0.5)',
                    'rgba(54, 162, 235, 0.5)',
                    'rgba(255, 206, 86, 0.5)',
                    'rgba(75, 192, 192, 0.5)',
                    'rgba(153, 102, 255, 0.5)',
                    'rgba(255, 159, 64, 0.5)'
                ];
                this.currentColorIndex = 0;
                
                this.history = [];
                this.historyStep = -1;
                
                this.init();
            }

            init() {
                this.setupCanvas();
                this.loadMapImage();
                this.bindEvents();
                this.updateUI();
                
                // 设置初始模式为拖拉模式
                this.setMode('drag');
            }

            setupCanvas() {
                const container = this.canvas.parentElement;
                this.canvas.width = container.clientWidth;
                this.canvas.height = container.clientHeight;
            }

            loadMapImage() {
                this.mapImage.onload = () => {
                    this.drawMap();
                };
                this.mapImage.onerror = () => {
                    console.error('地图图片加载失败');
                    this.drawFallbackMap();
                };
                this.mapImage.src = '地图.png';
            }

            drawFallbackMap() {
                // 如果地图图片加载失败，绘制一个备用地图
                this.ctx.fillStyle = '#90EE90';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.ctx.fillStyle = '#228B22';
                this.ctx.font = '24px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('教学地图区域', this.canvas.width / 2, this.canvas.height / 2);
                
                this.drawAreas();
            }

            drawMap() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // 绘制地图图片（不拉伸，保持原始比例）
                this.drawMapImage();
                
                // 绘制所有已完成的区域
                this.drawAreas();
                
                // 绘制当前正在绘制的区域
                this.drawCurrentArea();
            }

            drawMapImage() {
                if (!this.mapImage.complete) return;
                
                // 计算适合的显示尺寸（保持宽高比）
                const imgAspect = this.mapImage.width / this.mapImage.height;
                const canvasAspect = this.canvas.width / this.canvas.height;
                
                let drawWidth, drawHeight, offsetX, offsetY;
                
                if (imgAspect > canvasAspect) {
                    // 图片更宽，以宽度为基准
                    drawWidth = this.canvas.width * this.mapScale;
                    drawHeight = drawWidth / imgAspect;
                    offsetX = this.mapOffset.x;
                    offsetY = this.mapOffset.y + (this.canvas.height - drawHeight) / 2;
                } else {
                    // 图片更高，以高度为基准
                    drawHeight = this.canvas.height * this.mapScale;
                    drawWidth = drawHeight * imgAspect;
                    offsetX = this.mapOffset.x + (this.canvas.width - drawWidth) / 2;
                    offsetY = this.mapOffset.y;
                }
                
                // 绘制地图
                this.ctx.drawImage(this.mapImage, offsetX, offsetY, drawWidth, drawHeight);
                
                // 保存地图显示参数供坐标转换使用
                this.mapDisplayParams = {
                    offsetX, offsetY, drawWidth, drawHeight,
                    originalWidth: this.mapImage.width,
                    originalHeight: this.mapImage.height
                };
            }

            drawAreas() {
                this.areas.forEach((area, index) => {
                    this.drawPolygon(area.points, area.color, true);
                    // 根据该区域的calculateArea属性决定是否显示面积标签
                    if (area.calculateArea) {
                        this.drawAreaLabel(area);
                    }
                });
            }

            updateAreaLabels() {
                // 清除所有现有标签
                const labels = this.canvas.parentElement.querySelectorAll('.area-display');
                labels.forEach(label => label.remove());
                
                // 根据每个区域的calculateArea属性重新绘制标签
                this.areas.forEach(area => {
                    if (area.calculateArea) {
                        this.drawAreaLabel(area);
                    }
                });
            }

            drawCurrentArea() {
                if (this.currentArea.length > 0) {
                    const currentColor = this.colors[this.currentColorIndex % this.colors.length];
                    
                    // 绘制临时多边形（半透明填充）
                    if (this.currentArea.length >= 3) {
                        this.drawPolygon(this.currentArea, currentColor, false);
                    }
                    
                    // 绘制连线
                    this.drawCurrentLines();
                    
                    // 绘制点
                    this.drawCurrentPoints();
                }
            }

            drawCurrentLines() {
                if (this.currentArea.length < 2) return;
                
                this.ctx.strokeStyle = '#e74c3c';
                this.ctx.lineWidth = 2;
                this.ctx.setLineDash([5, 5]);
                
                this.ctx.beginPath();
                
                // 转换第一个点到画布坐标
                const firstCanvasPoint = this.mapToCanvasCoords(this.currentArea[0]);
                if (!firstCanvasPoint) return;
                
                this.ctx.moveTo(firstCanvasPoint.x, firstCanvasPoint.y);
                
                for (let i = 1; i < this.currentArea.length; i++) {
                    const canvasPoint = this.mapToCanvasCoords(this.currentArea[i]);
                    if (canvasPoint) {
                        this.ctx.lineTo(canvasPoint.x, canvasPoint.y);
                    }
                }
                
                this.ctx.stroke();
                this.ctx.setLineDash([]);
            }

            drawCurrentPoints() {
                this.currentArea.forEach((point, index) => {
                    const canvasPoint = this.mapToCanvasCoords(point);
                    if (!canvasPoint) return;
                    
                    this.ctx.fillStyle = index === 0 ? '#27ae60' : '#e74c3c';
                    this.ctx.strokeStyle = '#2c3e50';
                    this.ctx.lineWidth = 2;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(canvasPoint.x, canvasPoint.y, 6, 0, 2 * Math.PI);
                    this.ctx.fill();
                    this.ctx.stroke();
                    
                    // 绘制点的编号
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = 'bold 12px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText((index + 1).toString(), canvasPoint.x, canvasPoint.y + 4);
                });
            }

            drawPolygon(points, color, isComplete = true) {
                if (points.length < 2) return;

                this.ctx.fillStyle = color;
                this.ctx.strokeStyle = isComplete ? '#2c3e50' : '#e74c3c';
                this.ctx.lineWidth = isComplete ? 2 : 3;
                this.ctx.setLineDash(isComplete ? [] : [5, 5]);

                this.ctx.beginPath();
                
                // 转换第一个点到画布坐标
                const firstCanvasPoint = this.mapToCanvasCoords(points[0]);
                if (!firstCanvasPoint) return;
                
                this.ctx.moveTo(firstCanvasPoint.x, firstCanvasPoint.y);
                
                for (let i = 1; i < points.length; i++) {
                    const canvasPoint = this.mapToCanvasCoords(points[i]);
                    if (canvasPoint) {
                        this.ctx.lineTo(canvasPoint.x, canvasPoint.y);
                    }
                }
                
                if (isComplete) {
                    this.ctx.closePath();
                }
                
                this.ctx.fill();
                this.ctx.stroke();
                this.ctx.setLineDash([]);
            }

            drawAreaLabel(area) {
                const center = this.calculatePolygonCenter(area.points);
                const areaInSquareMeters = this.calculatePolygonArea(area.points);
                
                // 将地图坐标转换为画布坐标
                const canvasCenter = this.mapToCanvasCoords(center);
                if (!canvasCenter) return;
                
                // 创建面积显示标签
                const label = document.createElement('div');
                label.className = 'area-display';
                label.textContent = `${areaInSquareMeters.toFixed(0)}㎡`;
                label.style.left = `${canvasCenter.x - 30}px`;
                label.style.top = `${canvasCenter.y - 10}px`;
                
                this.canvas.parentElement.appendChild(label);
            }

            calculatePolygonCenter(points) {
                let sumX = 0, sumY = 0;
                for (let point of points) {
                    sumX += point.x;
                    sumY += point.y;
                }
                return {
                    x: sumX / points.length,
                    y: sumY / points.length
                };
            }

            calculatePolygonArea(points) {
                if (points.length < 3) return 0;
                
                let area = 0;
                for (let i = 0; i < points.length; i++) {
                    const j = (i + 1) % points.length;
                    area += points[i].x * points[j].y;
                    area -= points[j].x * points[i].y;
                }
                
                area = Math.abs(area) / 2;
                // 转换为平方米 (1厘米 = 80米，考虑屏幕像素密度)
                // 假设标准屏幕：1厘米 ≈ 37.8像素 (96 DPI)
                const pixelsPerCentimeter = 37.8;
                const scaleFactor = this.scale / pixelsPerCentimeter;
                return area * scaleFactor * scaleFactor;
            }

            bindEvents() {
                // 鼠标事件
                this.canvas.addEventListener('click', (e) => this.handleClick(e));
                this.canvas.addEventListener('dblclick', (e) => this.handleDoubleClick(e));
                
                // 拖动事件
                this.canvas.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                this.canvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                this.canvas.addEventListener('mouseup', (e) => this.handleMouseUp(e));
                this.canvas.addEventListener('mouseleave', (e) => this.handleMouseUp(e));
                
                // 触摸事件
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = this.canvas.getBoundingClientRect();
                    const point = {
                        x: touch.clientX - rect.left,
                        y: touch.clientY - rect.top
                    };
                    this.addPoint(point);
                });

                // 按钮事件
                document.getElementById('newAreaBtn').addEventListener('click', () => this.startNewArea());
                document.getElementById('undoBtn').addEventListener('click', () => this.undo());
                document.getElementById('clearAllBtn').addEventListener('click', () => this.clearAll());
                
                // 面积显示控制
                document.getElementById('showAreaToggle').addEventListener('change', (e) => {
                    this.showAreaLabels = e.target.checked;
                    this.updateAreaLabels();
                    this.drawMap();
                });

                // 模式切换按钮事件
                document.getElementById('dragModeBtn').addEventListener('click', () => {
                    this.setMode('drag');
                });
                
                document.getElementById('drawModeBtn').addEventListener('click', () => {
                    this.setMode('draw');
                });

                // 窗口大小调整
                window.addEventListener('resize', () => {
                    this.setupCanvas();
                    this.drawMap();
                });
            }

            handleMouseDown(e) {
                if (this.currentMode !== 'drag' || this.isDrawing) return; // 只在拖拉模式下允许拖动
                
                this.isDragging = true;
                this.dragStart.x = e.clientX;
                this.dragStart.y = e.clientY;
                this.updateCursor();
            }

            handleMouseMove(e) {
                if (!this.isDragging || this.currentMode !== 'drag' || this.isDrawing) return;
                
                const deltaX = e.clientX - this.dragStart.x;
                const deltaY = e.clientY - this.dragStart.y;
                
                this.mapOffset.x += deltaX;
                this.mapOffset.y += deltaY;
                
                this.dragStart.x = e.clientX;
                this.dragStart.y = e.clientY;
                
                this.drawMap();
            }

            handleMouseUp(e) {
                this.isDragging = false;
                this.updateCursor();
            }

            // 坐标转换：从画布坐标转换为地图原始坐标
            canvasToMapCoords(canvasPoint) {
                if (!this.mapDisplayParams) return canvasPoint;
                
                const { offsetX, offsetY, drawWidth, drawHeight, originalWidth, originalHeight } = this.mapDisplayParams;
                
                // 检查点是否在地图显示区域内
                if (canvasPoint.x < offsetX || canvasPoint.x > offsetX + drawWidth ||
                    canvasPoint.y < offsetY || canvasPoint.y > offsetY + drawHeight) {
                    return null; // 点在地图外
                }
                
                // 转换为地图原始坐标
                const mapX = ((canvasPoint.x - offsetX) / drawWidth) * originalWidth;
                const mapY = ((canvasPoint.y - offsetY) / drawHeight) * originalHeight;
                
                return { x: mapX, y: mapY };
            }

            // 坐标转换：从地图原始坐标转换为画布坐标
            mapToCanvasCoords(mapPoint) {
                if (!this.mapDisplayParams) return mapPoint;
                
                const { offsetX, offsetY, drawWidth, drawHeight, originalWidth, originalHeight } = this.mapDisplayParams;
                
                const canvasX = offsetX + (mapPoint.x / originalWidth) * drawWidth;
                const canvasY = offsetY + (mapPoint.y / originalHeight) * drawHeight;
                
                return { x: canvasX, y: canvasY };
            }

            handleClick(e) {
                if (this.isDragging || this.currentMode !== 'draw') return; // 只在绘制模式下处理点击
                
                const rect = this.canvas.getBoundingClientRect();
                const canvasPoint = {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
                
                // 转换为地图坐标
                const mapPoint = this.canvasToMapCoords(canvasPoint);
                if (!mapPoint) {
                    alert('请点击在地图区域内的位置！');
                    return;
                }
                
                this.addPoint(mapPoint);
            }

            handleDoubleClick(e) {
                e.preventDefault();
                if (this.isDragging || this.currentMode !== 'draw') return; // 只在绘制模式下处理双击
                this.finishCurrentArea();
            }

            addPoint(point) {
                if (!this.isDrawing) {
                    this.isDrawing = true;
                    this.updateStatus('开始绘制区域 - 点击添加点，双击完成');
                }
                
                this.currentArea.push(point);
                this.drawMap();
                this.updateUI();
                
                // 更新状态显示当前点数
                if (this.currentArea.length > 0) {
                    this.updateStatus(`已添加 ${this.currentArea.length} 个点 - 点击继续，双击完成`);
                }
            }

            finishCurrentArea() {
                if (this.currentArea.length < 3) {
                    alert('请至少点击3个点来创建一个有效的区域！');
                    return;
                }

                // 记录当前区域的计算面积状态（基于完成时的复选框状态）
                const shouldCalculateArea = this.showAreaLabels;
                const areaInSquareMeters = shouldCalculateArea ? this.calculatePolygonArea(this.currentArea) : 0;
                const color = this.colors[this.currentColorIndex % this.colors.length];
                
                this.areas.push({
                    points: [...this.currentArea],
                    area: areaInSquareMeters,
                    color: color,
                    calculateArea: shouldCalculateArea  // 记录该区域的计算面积状态
                });

                if (shouldCalculateArea) {
                    this.addHistory(`完成区域 ${this.areas.length}: ${areaInSquareMeters.toFixed(0)}平方米`);
                } else {
                    this.addHistory(`完成区域 ${this.areas.length}: 面积未计算`);
                }
                
                this.currentArea = [];
                this.isDrawing = false;
                this.currentColorIndex++;
                
                this.updateStatus('准备就绪');
                this.drawMap();
                this.updateUI();
            }

            startNewArea() {
                if (this.currentArea.length > 0) {
                    if (confirm('当前区域未完成，是否放弃当前绘制？')) {
                        this.currentArea = [];
                        this.isDrawing = false;
                        this.drawMap();
                        this.updateUI();
                    }
                }
                this.updateStatus('开始新区域绘制');
            }

            undo() {
                if (this.currentArea.length > 0) {
                    // 撤销当前绘制中的点
                    this.currentArea.pop();
                    if (this.currentArea.length === 0) {
                        this.isDrawing = false;
                        this.updateStatus('准备就绪');
                    } else {
                        this.updateStatus(`已添加 ${this.currentArea.length} 个点 - 点击继续，双击完成`);
                    }
                } else if (this.areas.length > 0) {
                    // 撤销已完成的区域
                    const removedArea = this.areas.pop();
                    this.currentColorIndex--;
                    
                    if (removedArea.calculateArea) {
                        this.addHistory(`撤销区域 ${this.areas.length + 1}: ${removedArea.area.toFixed(0)}平方米`);
                    } else {
                        this.addHistory(`撤销区域 ${this.areas.length + 1}: 面积未计算`);
                    }
                    
                    // 清除对应的面积标签（只有在该区域计算了面积时才清除）
                    if (removedArea.calculateArea) {
                        const labels = this.canvas.parentElement.querySelectorAll('.area-display');
                        labels.forEach(label => {
                            if (label.textContent.includes(`区域 ${this.areas.length + 1}:`)) {
                                label.remove();
                            }
                        });
                    }
                }
                
                this.drawMap();
                this.updateUI();
            }

            clearAll() {
                if (confirm('确定要清空所有区域吗？')) {
                    this.areas = [];
                    this.currentArea = [];
                    this.isDrawing = false;
                    this.currentColorIndex = 0;
                    
                    // 清除所有面积标签
                    const labels = this.canvas.parentElement.querySelectorAll('.area-display');
                    labels.forEach(label => label.remove());
                    
                    this.addHistory('清空所有区域');
                    this.updateStatus('准备就绪');
                    this.drawMap();
                    this.updateUI();
                }
            }

            addHistory(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.history.push(`[${timestamp}] ${message}`);
                
                // 限制历史记录数量
                if (this.history.length > 20) {
                    this.history.shift();
                }
                
                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const historyDiv = document.getElementById('history');
                if (this.history.length === 0) {
                    historyDiv.innerHTML = '等待开始测量...';
                } else {
                    historyDiv.innerHTML = this.history.slice(-5).reverse().join('<br>');
                }
            }

            updateStatus(message) {
                const statusDiv = document.getElementById('status');
                statusDiv.textContent = message;
                statusDiv.className = this.isDrawing ? 'status drawing' : 'status ready';
                
                // 更新鼠标样式
                this.updateCursor();
            }

            updateUI() {
                // 更新当前区域面积（基于当前复选框状态）
                const currentArea = this.showAreaLabels ? this.calculatePolygonArea(this.currentArea) : 0;
                document.getElementById('currentArea').textContent = 
                    this.showAreaLabels ? `当前区域面积: ${currentArea.toFixed(0)} 平方米` : '当前区域面积: 未计算';
                
                // 更新总面积（只计算标记为需要计算面积的区域）
                const totalArea = this.areas.reduce((sum, area) => {
                    return area.calculateArea ? sum + area.area : sum;
                }, 0);
                const calculatedAreasCount = this.areas.filter(area => area.calculateArea).length;
                document.getElementById('totalArea').textContent = 
                    calculatedAreasCount > 0 ? `总面积: ${totalArea.toFixed(0)} 平方米` : '总面积: 未计算';
                
                // 更新区域数量
                document.getElementById('areaCount').textContent = 
                    `区域数量: ${this.areas.length} 个`;
                
                // 更新撤销按钮状态
                document.getElementById('undoBtn').disabled = 
                    this.currentArea.length === 0 && this.areas.length === 0;
            }

            setMode(mode) {
                this.currentMode = mode;
                
                // 更新按钮状态
                document.getElementById('dragModeBtn').classList.toggle('active', mode === 'drag');
                document.getElementById('drawModeBtn').classList.toggle('active', mode === 'draw');
                
                // 更新鼠标样式
                this.updateCursor();
                
                // 更新状态
                if (mode === 'drag') {
                    this.updateStatus('拖拉模式 - 可以拖动地图');
                } else {
                    this.updateStatus('绘制模式 - 点击开始绘制区域');
                }
            }

            updateCursor() {
                if (this.currentMode === 'draw' && this.isDrawing) {
                    this.canvas.style.cursor = 'crosshair';
                } else if (this.currentMode === 'drag' && this.isDragging) {
                    this.canvas.style.cursor = 'grabbing';
                } else if (this.currentMode === 'drag') {
                    this.canvas.style.cursor = 'grab';
                } else {
                    this.canvas.style.cursor = 'default';
                }
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            new MapAreaCalculator();
        });
    </script>
</body>
</html>